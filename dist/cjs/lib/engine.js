"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.walkThroughHandler=exports.filterSchema=void 0;var k=require("./helpers.js");const I=(e,t,a,r)=>new RegExp((t?"^":"")+String(e).substr(1,String(e).length-2)+(a?"$":""),r||"gi"),w=(...e)=>e.length?new Date(...e):new Date,x=(e,t,a)=>Math.random().toString(e??20).substring(t??2,a??12),M=e=>{for(var t of k.monthMap)if(t[1].includes(e.toLowerCase()))return t[0]+1;return 0},T=e=>{for(var t of k.dayMap)if(t[1].includes(e.toLowerCase()))return t[0]+1;return 0};exports.filterSchema=async e=>{try{var t=await(async t=>{try{k.holder.propertyOps=new Map,k.holder.objectOps=new Map,k.holder.rootOp=null,k.holder.context="json";let u;return String(t).trim().startsWith("[")&&(k.holder.context="root",t="{ rootPropertyIdentifier }"+t),String(t).replace(I(k.patterns.general.newLine),"").replace(I(k.patterns.operations.propertyOp),(_,e)=>{let t=_.split("").indexOf("["),a=_.substring(0,t),r=_.substring(t).replace(I(k.patterns.general.opList),"]*^*[").split("*^*"),i="*instr-p:id_"+x(),n=r.map(e=>String(e).replace(I(k.patterns.general.operation,!0,!0),"")),s="and";(u=JSON.stringify(n)).match(/"cond:/)&&(s=u.match(/"cond:\\"or\\"/)?"or":"and",n=n.filter(e=>!e.match(/cond:/)));var _=I(k.patterns.general.omission,null,!0),l=a.trim().match(_);return k.holder.propertyOps.set(i,{property:a.trim().replace(_,""),operation:n,condition:s,omit:Boolean(l)}),i}).replace(I(k.patterns.operations.objectOp,null,!0),(_,e)=>{let t=_.split("").indexOf("["),a=_.substring(t).replace(I(k.patterns.general.opList),"]*^*[").split("*^*"),r=a.map(e=>String(e).replace(I(k.patterns.general.operation,!0,!0),""));return u=JSON.stringify(r),k.holder.condition=u.match(/"cond:/)&&u.match(/"cond:\\"or\\"/)?"or":"and",k.holder.mode=u.match(/"mode:/)&&u.match(/"mode:\\"or\\"/)?"or":"and",r=r.filter(e=>!e.match(/mode:/)&&!e.match(/cond:/)),k.holder.rootOp=r,"}"}).replace(I(k.patterns.operations.objectOp),(_,e)=>{let t=_.split("").indexOf("["),a=_.substring(t).replace(I(k.patterns.general.opList),"]*^*[").split("*^*"),r="*instr-o:id_"+x(),i=a.map(e=>String(e).replace(I(k.patterns.general.operation,!0,!0),"")),n="and",s="and";return(u=JSON.stringify(i)).match(/"cond:/)&&(n=u.match(/"cond:\\"or\\"/)?"or":"and",i=i.filter(e=>!e.match(/cond:/))),u.match(/"mode:/)&&(s=u.match(/"mode:\\"or\\"/)?"or":"and",i=i.filter(e=>!e.match(/mode:/))),k.holder.objectOps.set(r,{operation:i,mode:s,condition:n}),"} "+r})}catch(e){return t}})(e),a=String(t).replace(I(k.patterns.general.newLine),"").replace(I(k.patterns.schema.commaAndSpace)," ").replace(I(k.patterns.schema.objectProperty),(_,e)=>`"${e}"`).replace(I(k.patterns.schema.spaceAndBrace),(_,e)=>({'" "':'":1, "','" {':'": {','"{':'": {','" }':'":1 }','"}':'":1 }'})[_]||"").replace(I(k.patterns.schema.braceAndSpace),'}, "');return{status:!0,schema:JSON.parse(a)}}catch(e){return{status:!1,err:e}}};exports.walkThroughHandler=async({data:t,schema:a})=>{if(a)try{var r,i,n="string"==typeof t&&"root"!=k.holder.context?JSON.parse(t):t;let e="json"==k.holder.context?(await L({schema:a,subject:n})).result:n;return k.holder.rootOp&&(r="*instr-p:id_"+x(),k.holder.propertyOps.set(r,{property:k.holder.rootKey,operation:k.holder.rootOp,condition:k.holder.condition}),i=await L({schema:{[r]:1},subject:{[k.holder.rootKey]:e}}),e=i.schemaPass?i.result[k.holder.rootKey]:i.result[k.holder.rootKey]instanceof Array?[]:Object.create(null)),e}catch(e){return console.error(new Date,e,a),null}};const L=async({schema:d,subject:c,mode:e})=>{let g={},t=!0,a=new Set([]),D=null;if(Array.isArray(c)){g=[];for(var r of c){r=await L({schema:d,subject:r,mode:e});r.schemaPass&&g.push(r.result)}}else{let s=Object.keys(d),o=-1;for(var h of s){++o;let l=!0,u=new Set([]),m=null,e=I(k.patterns.general.omission,null,!0),i=Boolean(h.match(e)),n=h;if(h=h.replace(e,""),k.holder.propertyOps.has(h)){let s=c[(m=k.holder.propertyOps.get(h)).property];if(c.hasOwnProperty(m.property)){for(let t=0;t<m.operation.length;t++){var p=m.operation[t],v=p.split("").indexOf(":");let[r,e]=[p.substr(0,v),p.substr(++v)],i={},n=(r=r||e,e&&(D=String(e).replace(I(k.patterns.general.quotes,!0,!0),"")||""),["in","nin","ini","nini","sin","snin","dtin","dtnin","dtinrange","dtninrange","dtmin","dtmnin","dtminrange","dtmninrange","yin","ynin","yinrange","yninrange","min","mnin","minrange","mninrange","din","dnin","dinrange","dninrange","dwin","dwnin","dwinrange","dwninrange","hin","hnin","hinrange","hninrange","minin","minnin","mininrange","minninrange","tin","tnin","tinrange","tninrange","agoin","btw"].includes(r)?String(D).replace(I(k.patterns.general.operation,!0,!0),"").split(",").map(e=>{e=String(e).trim().replace(I(k.patterns.general.quotes,!0,!0),"");return["sin","snin","yin","ynin","btw"].includes(r)?Number(e):e}):[]);switch(r){case"as":m.alias=D;break;case"rew":D=D==r?"":D,s=String(s).replace(I(k.patterns.general.raws),D||"");break;case"rw":D=D==r?"":D,s=String(s).replace(I(k.patterns.general.ws),D||"");break;case"eq":l=String(s)===D;break;case"eqi":l=String(s).toLowerCase()===D.toLowerCase();break;case"ne":l=String(s)!==D;break;case"nei":l=String(s).toLowerCase()!==D.toLowerCase();break;case"gt":l=Number(s)>Number(D);break;case"gte":l=Number(s)>=Number(D);break;case"lt":l=Number(s)<Number(D);break;case"lte":l=Number(s)<=Number(D);break;case"nn":l=![null,void 0,""].includes(s);break;case"in":l=Array.isArray(s)?s.some(t=>n.some(e=>e==t||e===t)):n.some(e=>e==s||e===s);break;case"nin":l=Array.isArray(s)?s.every(t=>!n.some(e=>e==t||e===t)):!n.some(e=>e==s||e===s);break;case"ini":case"nini":n=n.join(",").toLowerCase().split(","),i.status=Array.isArray(s)?s.some(e=>Array.from(n).includes(String(e).toLowerCase())):Array.from(n).includes(String(s).toLowerCase()),l="ini"==r?i.status:!i.status;break;case"regex":case"regexne":i.regexPattern=D.trim().substring(1).split("/"),i.status=new RegExp(i.regexPattern[0],i.regexPattern[1]).test(s),l="regex"==r?i.status:!i.status;break;case"regexin":case"regexnin":i.regexCluster=D.replace(I(k.patterns.general.operation,!0,!0),"").split(","),l=i.regexCluster.some(e=>(i.regexPattern=e.trim().substring(1).split("/"),i.status=Array.isArray(s)?s.some(e=>new RegExp(i.regexPattern[0],i.regexPattern[1]).test(e)):new RegExp(i.regexPattern[0],i.regexPattern[1]).test(s),"regexin"==r?i.status:!i.status));break;case"size":s=s instanceof Array||"string"==typeof s?s.length:"object"==typeof s?Object.keys(s).length:s;break;case"seq":l=s.length==Number(D);break;case"sne":l=s.length!=Number(D);break;case"sgt":l=s.length>Number(D);break;case"slt":l=s.length<Number(D);break;case"sgte":l=s.length>=Number(D);break;case"slte":l=s.length<=Number(D);break;case"sin":case"snin":var[b,f]=[Math.min(...Array.from(n)),Math.max(...Array.from(n))];i.status=s.length>=b&&s.length<=f,l="sin"==r?i.status:!i.status;break;case"dteq":case"dtne":[i.valueDate,i.filteredDate]=[w(s).toLocaleDateString(),w(D).toLocaleDateString()],i.status="Invalid Date"!=i.valueDate&&i.valueDate==i.filteredDate,l="dteq"==r?i.status:!i.status;break;case"dtgt":case"dtlt":[i.valueDate,i.filteredDate]=[w(w(s).toLocaleDateString()),w(w(D).toLocaleDateString())],l=![String(i.valueDate),String(i.filteredDate)].includes("Invalid Date")&&("dtgt"==r?i.valueDate>i.filteredDate:i.valueDate<i.filteredDate);break;case"dtgte":case"dtlte":[i.valueDate,i.filteredDate]=[w(s),w(D)],l=![String(i.valueDate),String(i.filteredDate)].includes("Invalid Date")&&(("dtgte"==r?i.valueDate>i.filteredDate:i.valueDate<i.filteredDate)||i.valueDate.toLocaleDateString()==i.filteredDate.toLocaleDateString());break;case"dtin":case"dtnin":i.valueDate=w(s).toLocaleDateString(),i.haystack=n,i.status=i.haystack.some(e=>{e=w(e).toLocaleDateString();return"Invalid Date"!=e&&i.valueDate==e}),l=![String(i.valueDate)].includes("Invalid Date")&&("dtin"==r?i.status:!i.status);break;case"dtinrange":case"dtninrange":i.valueDate=w(w(s).toLocaleDateString()),i.haystack={min:w(w(n[0]).toLocaleDateString()),max:2==n.length?w(w(n[1]).toLocaleDateString()):w().toLocaleDateString()},i.status=(i.valueDate>i.haystack.min||i.valueDate.toLocaleDateString()==i.haystack.min.toLocaleDateString())&&(i.valueDate<i.haystack.max||i.valueDate.toLocaleDateString()==i.haystack.max.toLocaleDateString()),l=![String(i.valueDate),String(i.haystack.min),String(i.haystack.max)].includes("Invalid Date")&&("dtinrange"==r?i.status:!i.status);break;case"dtmeq":case"dtmne":[i.valueDate,i.filteredDate]=[w(s),w(D)],i.status="Invalid Date"!=String(i.valueDate)&&String(i.valueDate)==String(i.filteredDate),l="dtmeq"==r?i.status:!i.status;break;case"dtmgt":case"dtmlt":[i.valueDate,i.filteredDate]=[w(s),w(D)],l=![String(i.valueDate),String(i.filteredDate)].includes("Invalid Date")&&("dtmgt"==r?i.valueDate>i.filteredDate:i.valueDate<i.filteredDate);break;case"dtmgte":case"dtmlte":[i.valueDate,i.filteredDate]=[w(s),w(D)],l=![String(i.valueDate),String(i.filteredDate)].includes("Invalid Date")&&(("dtmgte"==r?i.valueDate>i.filteredDate:i.valueDate<i.filteredDate)||String(i.valueDate)==String(i.filteredDate));break;case"dtmin":case"dtmnin":i.valueDate=w(s),i.haystack=n,i.status=i.haystack.some(e=>{e=w(e);return"Invalid Date"!=e&&String(i.valueDate)==String(e)}),l=![String(i.valueDate)].includes("Invalid Date")&&("dtmin"==r?i.status:!i.status);break;case"dtminrange":case"dtmninrange":i.valueDate=w(s),i.haystack={min:w(n[0]),max:w(n[1])},i.status=(i.valueDate>i.haystack.min||String(i.valueDate)==String(i.haystack.min))&&(i.valueDate<i.haystack.max||String(i.valueDate)==String(i.haystack.max)),l=![String(i.valueDate),String(i.haystack.min),String(i.haystack.max)].includes("Invalid Date")&&("dtminrange"==r?i.status:!i.status);break;case"yeq":case"yne":[i.valueDate,i.filteredDate]=[w(s),D],i.status=![String(i.valueDate)].includes("Invalid Date")&&String(i.valueDate.getFullYear())==String(i.filteredDate),l="yeq"==r?i.status:!i.status;break;case"ygt":case"ylt":[i.valueDate,i.filteredDate]=[w(s),D],l=![String(i.valueDate)].includes("Invalid Date")&&("ygt"==r?Number(i.valueDate.getFullYear())>Number(i.filteredDate):Number(i.valueDate.getFullYear())<Number(i.filteredDate));break;case"ygte":case"ylte":[i.valueDate,i.filteredDate]=[w(s),D],l=![String(i.valueDate)].includes("Invalid Date")&&("ygte"==r?Number(i.valueDate.getFullYear())>=Number(i.filteredDate):Number(i.valueDate.getFullYear())<=Number(i.filteredDate));break;case"yin":case"ynin":i.valueDate=w(s),i.haystack=n,i.status=i.haystack.some(e=>"Invalid Date"!=e&&String(i.valueDate.getFullYear())==String(e)),l=![String(i.valueDate)].includes("Invalid Date")&&("yin"==r?i.status:!i.status);break;case"yinrange":case"yninrange":i.valueDate=w(s),i.haystack={min:n[0],max:n[1]},i.status=Number(i.valueDate.getFullYear())>=Number(i.haystack.min)&&Number(i.valueDate.getFullYear())<=Number(i.haystack.max),l=![String(i.valueDate)].includes("Invalid Date")&&("yinrange"==r?i.status:!i.status);break;case"meq":case"mne":[i.valueDate,i.filteredDate]=[w(s),D],i.monthFilter=(i.valueDate.getMonth()||0)+1,i.status=![String(i.valueDate)].includes("Invalid Date")&&(isNaN(i.filteredDate)&&Array.from(k.monthMap.get(i.valueDate.getMonth())).includes(String(i.filteredDate).toLowerCase())||!isNaN(i.filteredDate)&&String(i.monthFilter)==String(Number(i.filteredDate))),l="meq"==r?i.status:!i.status;break;case"mgt":case"mlt":i.valueDate=w(s),i.monthFilter=(i.valueDate.getMonth()||0)+1,i.filteredDate=isNaN(D)?M(D):D,l=![String(i.valueDate)].includes("Invalid Date")&&1<=Number(i.filteredDate)&&Number(i.filteredDate)<=12&&("mgt"==r?Number(i.monthFilter)>Number(i.filteredDate):Number(i.monthFilter)<Number(i.filteredDate));break;case"mgte":case"mlte":i.valueDate=w(s),i.monthFilter=(i.valueDate.getMonth()||0)+1,i.filteredDate=isNaN(D)?M(D):D,l=![String(i.valueDate)].includes("Invalid Date")&&1<=Number(i.filteredDate)&&Number(i.filteredDate)<=12&&("mgte"==r?Number(i.monthFilter)>=Number(i.filteredDate):Number(i.monthFilter)<=Number(i.filteredDate));break;case"min":case"mnin":i.valueDate=w(s),i.monthFilter=(i.valueDate.getMonth()||0)+1,i.haystack=n,i.status=i.haystack.some(e=>{e=isNaN(e)?M(e):e;return String(i.monthFilter)==String(Number(e))}),l=![String(i.valueDate)].includes("Invalid Date")&&("min"==r?i.status:!i.status);break;case"minrange":case"mninrange":i.valueDate=w(s),i.monthFilter=(i.valueDate.getMonth()||0)+1,i.isNaN=n.some(e=>isNaN(e)),i.haystack=i.isNaN?n.map(e=>isNaN(e)?M(e):e):[n[0],n[1]],i.haystack={min:Math.min(i.haystack[0],i.haystack[1]),max:Math.max(i.haystack[0],i.haystack[1])},i.status=1<=Number(i.haystack.min)&&Number(i.haystack.max)<=12&&Number(i.monthFilter)>=Number(i.haystack.min)&&Number(i.monthFilter)<=Number(i.haystack.max),l=![String(i.valueDate)].includes("Invalid Date")&&("minrange"==r?i.status:!i.status);break;case"today":[i.valueDate,i.filteredDate]=[w(s),w()],l=![String(i.valueDate)].includes("Invalid Date")&&i.valueDate.toLocaleDateString()==i.filteredDate.toLocaleDateString();break;case"deq":case"dne":[i.valueDate,i.filteredDate]=[w(s),D],i.status=![String(i.valueDate)].includes("Invalid Date")&&!isNaN(i.filteredDate)&&String(i.valueDate.getDate())==String(Number(i.filteredDate)),l="deq"==r?i.status:!i.status;break;case"dgt":case"dlt":[i.valueDate,i.filteredDate]=[w(s),D],l=![String(i.valueDate)].includes("Invalid Date")&&("dgt"==r?Number(i.valueDate.getDate())>Number(i.filteredDate):Number(i.valueDate.getDate())<Number(i.filteredDate));break;case"dgte":case"dlte":[i.valueDate,i.filteredDate]=[w(s),D],l=![String(i.valueDate)].includes("Invalid Date")&&("dgte"==r?Number(i.valueDate.getDate())>=Number(i.filteredDate):Number(i.valueDate.getDate())<=Number(i.filteredDate));break;case"din":case"dnin":i.valueDate=w(s),i.haystack=n,i.status=i.haystack.some(e=>String(Number(i.valueDate.getDate()))==String(Number(e))),l=![String(i.valueDate)].includes("Invalid Date")&&("din"==r?i.status:!i.status);break;case"dinrange":case"dninrange":i.valueDate=w(s),i.haystack={min:Math.min(n[0],n[1]),max:Math.max(n[0],n[1])},i.status=1<=Number(i.haystack.min)&&Number(i.haystack.max)<=31&&Number(i.valueDate.getDate())>=Number(i.haystack.min)&&Number(i.valueDate.getDate())<=Number(i.haystack.max),l=![String(i.valueDate)].includes("Invalid Date")&&("dinrange"==r?i.status:!i.status);break;case"dweq":case"dwne":[i.valueDate,i.filteredDate]=[w(s),D],i.dayFilter=(i.valueDate.getDay()||0)+1,i.status=![String(i.valueDate)].includes("Invalid Date")&&(isNaN(i.filteredDate)&&Array.from(k.dayMap.get(i.valueDate.getDay())).includes(String(i.filteredDate).toLowerCase())||!isNaN(i.filteredDate)&&String(i.dayFilter)==String(Number(i.filteredDate))),l="dweq"==r?i.status:!i.status;break;case"dwgt":case"dwlt":i.valueDate=w(s),i.dayFilter=(i.valueDate.getDay()||0)+1,i.filteredDate=isNaN(D)?T(D):D,l=![String(i.valueDate)].includes("Invalid Date")&&1<=Number(i.filteredDate)&&Number(i.filteredDate)<=7&&("dwgt"==r?Number(i.dayFilter)>Number(i.filteredDate):Number(i.dayFilter)<Number(i.filteredDate));break;case"dwgte":case"dwlte":i.valueDate=w(s),i.dayFilter=(i.valueDate.getDay()||0)+1,i.filteredDate=isNaN(D)?T(D):D,l=![String(i.valueDate)].includes("Invalid Date")&&1<=Number(i.filteredDate)&&Number(i.filteredDate)<=7&&("dwgte"==r?Number(i.dayFilter)>=Number(i.filteredDate):Number(i.dayFilter)<=Number(i.filteredDate));break;case"dwin":case"dwnin":i.valueDate=w(s),i.dayFilter=(i.valueDate.getDay()||0)+1,i.haystack=n,i.status=i.haystack.some(e=>{e=isNaN(e)?T(e):e;return String(i.dayFilter)==String(Number(e))}),l=![String(i.valueDate)].includes("Invalid Date")&&("dwin"==r?i.status:!i.status);break;case"dwinrange":case"dwninrange":i.valueDate=w(s),i.dayFilter=(i.valueDate.getDay()||0)+1,i.isNaN=n.some(e=>isNaN(e)),i.haystack=i.isNaN?n.map(e=>isNaN(e)?T(e):e):[n[0],n[1]],i.haystack={min:Math.min(i.haystack[0],i.haystack[1]),max:Math.max(i.haystack[0],i.haystack[1])},i.status=1<=Number(i.haystack.min)&&Number(i.haystack.max)<=7&&Number(i.dayFilter)>=Number(i.haystack.min)&&Number(i.dayFilter)<=Number(i.haystack.max),l=![String(i.valueDate)].includes("Invalid Date")&&("dwinrange"==r?i.status:!i.status);break;case"heq":case"hne":case"hgt":case"hlt":case"hgte":case"hlte":switch([i.valueDate,i.filteredDate]=[w(s),D],i.isNaN=isNaN(i.filteredDate),i.timeInfo=i.isNaN?{hour:Number(i.filteredDate.replace(I(k.patterns.general.nonDigit),"")),meridiem:i.filteredDate.replace(I(k.patterns.general.nonAlphabet),"")}:{hour:Number(i.filteredDate)},i.isNaN&&(i.timeInfo.hour+="pm"==i.timeInfo.meridiem.toLowerCase()&&12!=i.timeInfo.hour?12:"am"==i.timeInfo.meridiem.toLowerCase()&&12!=i.timeInfo.hour||"am"==i.timeInfo.meridiem.toLowerCase()?0:-12),r){case"heq":case"hne":i.status=![String(i.valueDate)].includes("Invalid Date")&&String(i.valueDate.getHours())==String(i.timeInfo.hour),l="heq"==r?i.status:!i.status;break;case"hgt":case"hlt":l=![String(i.valueDate)].includes("Invalid Date")&&("hgt"==r?i.valueDate.getHours()>i.timeInfo.hour:i.valueDate.getHours()<i.timeInfo.hour);break;default:l=![String(i.valueDate)].includes("Invalid Date")&&("hgte"==r?i.valueDate.getHours()>=i.timeInfo.hour:i.valueDate.getHours()<=i.timeInfo.hour)}break;case"hin":case"hnin":i.valueDate=w(s),i.status=![String(i.valueDate)].includes("Invalid Date")&&n.some(e=>(i.isNaN=isNaN(e),i.timeInfo=i.isNaN?{hour:Number(String(e).replace(I(k.patterns.general.nonDigit),"")),meridiem:String(e).replace(I(k.patterns.general.nonAlphabet),"")}:{hour:Number(e)},i.isNaN&&(i.timeInfo.hour+="pm"==i.timeInfo.meridiem.toLowerCase()&&12!=i.timeInfo.hour?12:"am"==i.timeInfo.meridiem.toLowerCase()&&12!=i.timeInfo.hour||"am"==i.timeInfo.meridiem.toLowerCase()?0:-12),String(i.valueDate.getHours())==String(i.timeInfo.hour))),l="hin"==r?i.status:!i.status;break;case"hinrange":case"hninrange":i.valueDate=w(s),i.haystack=2<=n.length?[n[0],n[1]]:[n[0],n[0]],i.timeInfoRange=i.haystack.map(e=>(i.isNaN=isNaN(e),i.timeInfo=i.isNaN?{hour:Number(String(e).replace(I(k.patterns.general.nonDigit),"")),meridiem:String(e).replace(I(k.patterns.general.nonAlphabet),"")}:{hour:Number(e)},i.isNaN&&(i.timeInfo.hour+="pm"==i.timeInfo.meridiem.toLowerCase()&&12!=i.timeInfo.hour?12:"am"==i.timeInfo.meridiem.toLowerCase()&&12!=i.timeInfo.hour||"am"==i.timeInfo.meridiem.toLowerCase()?0:-12),i.timeInfo.hour)),i.haystack=[Math.min(...i.timeInfoRange),Math.max(...i.timeInfoRange)],i.status=![String(i.valueDate)].includes("Invalid Date")&&Number(i.valueDate.getHours())>=i.haystack[0]&&Number(i.valueDate.getHours())<=i.haystack[1],l="hinrange"==r?i.status:!i.status;break;case"mineq":case"minne":case"mingt":case"minlt":case"mingte":case"minlte":switch([i.valueDate,i.filteredDate]=[w(s),D],i.minutes=i.valueDate.getMinutes(),r){case"mineq":case"minne":i.status=![String(i.valueDate)].includes("Invalid Date")&&String(i.minutes)==String(Number(i.filteredDate)),l="mineq"==r?i.status:!i.status;break;case"mingt":case"minlt":l=![String(i.valueDate)].includes("Invalid Date")&&("mingt"==r?i.minutes>Number(i.filteredDate):i.minutes<Number(i.filteredDate));break;default:l=![String(i.valueDate)].includes("Invalid Date")&&("mingte"==r?i.minutes>=Number(i.filteredDate):i.minutes<=Number(i.filteredDate))}break;case"minin":case"minnin":i.valueDate=w(s),i.minutes=i.valueDate.getMinutes(),i.status=![String(i.valueDate)].includes("Invalid Date")&&n.some(e=>String(Number(e))==String(i.minutes)),l="minin"==r?i.status:!i.status;break;case"mininrange":case"minninrange":i.valueDate=w(s),i.minutes=i.valueDate.getMinutes(),i.haystack=2<=n.length?[n[0],n[1]]:[n[0],n[n.length-1]],i.status=![String(i.valueDate)].includes("Invalid Date")&&i.minutes>=i.haystack[0]&&i.minutes<=i.haystack[1],l="mininrange"==r?i.status:!i.status;break;case"teq":case"tne":case"tgt":case"tlt":switch([i.valueDate,i.filteredDate]=[w(s),D],i.possibleMeridiem=i.filteredDate.replace(I(k.patterns.general.nonAlphabet),"").toLowerCase(),i.hasMeridiem=["am","pm"].includes(i.possibleMeridiem),i.timeParts=i.filteredDate.replace(I(k.patterns.general.nonTimeXter),"").split(":").map(e=>Number(e)),i.timeInfo=i.hasMeridiem?{hour:Number(i.timeParts[0]),meridiem:i.possibleMeridiem}:{hour:Number(i.timeParts[0])},i.hasMeridiem&&(i.timeInfo.hour+="pm"==i.timeInfo.meridiem&&12!=i.timeInfo.hour?12:"am"==i.timeInfo.meridiem&&12!=i.timeInfo.hour||"am"==i.timeInfo.meridiem?0:-12),i.timeParts[0]=i.timeInfo.hour,i.valueTimeParts=[i.valueDate.getHours(),i.valueDate.getMinutes(),i.valueDate.getSeconds()],i.valueDateTime=w(...k.holder.defaultDate,...i.valueTimeParts),i.filteredDateTime=w(...k.holder.defaultDate,...i.timeParts),r){case"teq":case"tne":i.status=![String(i.valueDate)].includes("Invalid Date")&&String(i.valueDateTime)==String(i.filteredDateTime),l="teq"==r?i.status:!i.status;break;case"tgt":case"tlt":l=![String(i.valueDate)].includes("Invalid Date")&&("tgt"==r?i.valueDateTime>i.filteredDateTime:i.valueDateTime<i.filteredDateTime);break;case"tgte":case"tlte":l=![String(i.valueDate)].includes("Invalid Date")&&("tgte"==r?i.valueDateTime>=i.filteredDateTime:i.valueDateTime<=i.filteredDateTime)}break;case"tin":case"tnin":i.valueDate=w(s),i.valueTimeParts=[i.valueDate.getHours(),i.valueDate.getMinutes(),i.valueDate.getSeconds()],i.valueDateTime=w(...k.holder.defaultDate,...i.valueTimeParts),i.status=![String(i.valueDate)].includes("Invalid Date")&&n.some(e=>(i.possibleMeridiem=String(e).replace(I(k.patterns.general.nonAlphabet),"").toLowerCase(),i.hasMeridiem=["am","pm"].includes(i.possibleMeridiem),i.timeParts=String(e).replace(I(k.patterns.general.nonTimeXter),"").split(":").map(e=>Number(e)),i.timeInfo=i.hasMeridiem?{hour:Number(i.timeParts[0]),meridiem:i.possibleMeridiem}:{hour:Number(i.timeParts[0])},i.hasMeridiem&&(i.timeInfo.hour+="pm"==i.timeInfo.meridiem&&12!=i.timeInfo.hour?12:"am"==i.timeInfo.meridiem&&12!=i.timeInfo.hour||"am"==i.timeInfo.meridiem?0:-12),i.timeParts[0]=i.timeInfo.hour,i.filteredDateTime=w(...k.holder.defaultDate,...i.timeParts),String(i.valueDateTime)==String(i.filteredDateTime))),l="tin"==r?i.status:!i.status;break;case"tinrange":case"tninrange":i.valueDate=w(s),i.valueTimeParts=[i.valueDate.getHours(),i.valueDate.getMinutes(),i.valueDate.getSeconds()],i.valueDateTime=w(...k.holder.defaultDate,...i.valueTimeParts),i.haystack=2<=n.length?[n[0],n[1]]:[n[0],n[0]],i.haystackTimeParts=i.haystack.map(e=>(i.possibleMeridiem=String(e).replace(I(k.patterns.general.nonAlphabet),"").toLowerCase(),i.hasMeridiem=["am","pm"].includes(i.possibleMeridiem),i.timeParts=String(e).replace(I(k.patterns.general.nonTimeXter),"").split(":").map(e=>Number(e)),i.timeInfo=i.hasMeridiem?{hour:Number(i.timeParts[0]),meridiem:i.possibleMeridiem}:{hour:Number(i.timeParts[0])},i.hasMeridiem&&(i.timeInfo.hour+="pm"==i.timeInfo.meridiem&&12!=i.timeInfo.hour?12:"am"==i.timeInfo.meridiem&&12!=i.timeInfo.hour||"am"==i.timeInfo.meridiem?0:-12),i.timeParts[0]=i.timeInfo.hour,w(...k.holder.defaultDate,...i.timeParts))),i.status=![String(i.valueDate)].includes("Invalid Date")&&(i.valueDateTime>i.haystackTimeParts[0]||String(i.valueDateTime)==String(i.haystackTimeParts[0]))&&(i.valueDateTime<i.haystackTimeParts[1]||String(i.valueDateTime)==String(i.haystackTimeParts[1])),l="tinrange"==r?i.status:!i.status;break;case"ago":[i.valueDate,i.filteredDate]=[w(s),D],i.timeSpan={sign:i.filteredDate.replace(I(k.patterns.general.nonSign),""),time:i.filteredDate.replace(I(k.patterns.general.nonDecimal),""),duration:i.filteredDate.replace(I(k.patterns.general.nonAlphabet),"").toLowerCase()},l=!!(k.timeDuration.includes(i.timeSpan.duration)&&0<Number(i.timeSpan.time))&&(i.timeSpan.ticks=k.timeDurationMap.get(i.timeSpan.duration),i.timeSpan.ms=Number(i.timeSpan.time)*i.timeSpan.ticks,i.timeSpan.lapse=w().getTime()-i.timeSpan.ms,i.range={min:i.timeSpan.lapse,max:i.timeSpan.lapse+i.timeSpan.ticks,maxWithSign:"+"==i.timeSpan.sign?w().getTime():null},i.status=i.timeSpan.sign?"+"==i.timeSpan.sign?i.valueDate.getTime()>=i.range.min&&i.valueDate.getTime()<=(i.range.maxWithSign||i.range.max):i.valueDate.getTime()<=i.range.min:i.valueDate.getTime()>=i.range.min&&i.valueDate.getTime()<=i.range.max,![String(i.valueDate)].includes("Invalid Date"))&&i.status;break;case"agoin":i.valueDate=w(s),i.haystack=2==n.length?[n[0],n[1]]:[n[0],n[0]],i.haystackTimeMs=i.haystack.map(e=>(i.timeSpan={time:e.replace(I(k.patterns.general.nonDecimal),""),duration:e.replace(I(k.patterns.general.nonAlphabet),"").toLowerCase()},k.timeDuration.includes(i.timeSpan.duration)&&0<Number(i.timeSpan.time)?(i.timeSpan.ticks=k.timeDurationMap.get(i.timeSpan.duration),i.timeSpan.ms=Number(i.timeSpan.time)*i.timeSpan.ticks,i.timeSpan.lapse=w().getTime()-i.timeSpan.ms,{min:i.timeSpan.lapse,max:i.timeSpan.lapse+i.timeSpan.ticks}):0)),i.range={min:Math.min(i.haystackTimeMs[0].min,i.haystackTimeMs[1].min),max:Math.max(i.haystackTimeMs[0].max,i.haystackTimeMs[1].max)},i.status=i.valueDate.getTime()>=i.range.min&&i.valueDate.getTime()<=i.range.max,l=![String(i.valueDate)].includes("Invalid Date")&&i.status;break;case"first":s=Array.isArray(s)?isNaN(D)?s[0]||[]:s.slice(0,Number(D)):s;break;case"last":s=Array.isArray(s)?isNaN(D)?s[s.length-1]||[]:s.slice(-Number(D.replace(I(k.patterns.general.nonDigit),""))):s;break;case"btw":i.haystack=2==n.length?[Number(n[0])-1,n[1]]:[0,n[0]],s=Array.isArray(s)?s.slice(i.haystack[0],i.haystack[1])||[]:s;break;case"dist":let t=new Set([]),a=new Set([]);s=Array.isArray(s)?Array.from(s,e=>"object"!=typeof e||r==D?t.add(e):e[D]&&a.has(e[D])?null:t.add(e)&&a.add(e[D])):s,s=Array.from(t.values())}u.add(l)}m.omit||(g[m.alias||m.property]=s)}}else if(c.hasOwnProperty(h))if(1===d[h])i||(g[h]=c[h]);else{let e=!1,t="and",a=String(),r=null;var y,S,N;k.holder.objectOps.has(s[o+1])&&(S=s[o+1],y=h,r=k.holder.objectOps.get(S),a="*instr-p:id_"+x(),t=r.mode,r.operation.length)&&(S=r.operation.findIndex(e=>e.match(/^as:\".*\"$/)),e=!(0<=S)||(N=String(r.operation[S]).split(":")[1],r.currentKeyAlias=N.replace(I(k.patterns.general.quotes,!0,!0),""),r.operation.splice(S,1),0<r.operation.length),k.holder.propertyOps.set(a,{property:y,operation:r.operation,condition:r.condition})),i&&!e||(g[r?.currentKeyAlias||h]=(await L({schema:d[h]??d[n],subject:c[h],mode:t})).result),e&&(N=await L({schema:{[a]:1},subject:{[h]:g[r?.currentKeyAlias||h]}}),i?delete g[r?.currentKeyAlias||h]:g[r?.currentKeyAlias||h]=N.schemaPass?N.result[h]:N.result[h]instanceof Array?[]:Object.create(null),u.add(N.schemaPass))}a.add(1<u.size?"or"==m.condition:Array.from(u.values())[0]??l)}t=k.holder.propertyOps.size<1||(1<a.size?"or"==(e??k.holder.mode):Array.from(a.values())[0])}return{schemaPass:t,result:g}};